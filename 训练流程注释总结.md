# ğŸš€ TrackTacular è®­ç»ƒæµç¨‹è¯¦ç»†æ³¨é‡Šæ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº† TrackTacular ä»æ•°æ®åŠ è½½åˆ°æŸå¤±è¯„ä¼°çš„å®Œæ•´è®­ç»ƒæµç¨‹ï¼Œæ‰€æœ‰å…³é”®ä»£ç æ–‡ä»¶éƒ½å·²æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šã€‚

## ğŸ“‹ å·²å®Œæˆæ³¨é‡Šçš„æ–‡ä»¶åˆ—è¡¨

### 1. é…ç½®æ–‡ä»¶ âœ…
- **`configs/t_fit.yml`** - è®­ç»ƒå™¨é…ç½®ï¼ˆGPUã€epochsã€callbacksç­‰ï¼‰
- **`configs/d_wildtrack.yml`** - Wildtrackæ•°æ®é›†é…ç½®ï¼ˆåˆ†è¾¨ç‡ã€è¾¹ç•Œã€ç›¸æœºæ•°ç­‰ï¼‰
- **`configs/m_liftnet.yml`** - Liftnetæ¨¡å‹é…ç½®ï¼ˆæ¶æ„ã€ç‰¹å¾ç»´åº¦ç­‰ï¼‰

### 2. æ•°æ®åŠ è½½æ¨¡å— âœ…
- **`datasets/wildtrack_dataset.py`** - Wildtrackæ•°æ®é›†åŸºç±»ï¼ˆæ ‡å®šã€å›¾åƒè·¯å¾„ã€åæ ‡è½¬æ¢ï¼‰
- **`datasets/pedestrian_dataset.py`** - æ•°æ®é›†åŒ…è£…ç±»ï¼ˆæ•°æ®å¢å¼ºã€GTç”Ÿæˆã€åæ ‡å˜æ¢ï¼‰
- **`datasets/pedestrian_datamodule.py`** - PyTorch Lightningæ•°æ®æ¨¡å—ï¼ˆDataLoaderé…ç½®ï¼‰

### 3. æ¨¡å‹æ¶æ„ âœ…
- **`models/liftnet.py`** - æ ¸å¿ƒLiftnetæ¨¡å‹ï¼ˆ2Dâ†’3Dç‰¹å¾æå‡ã€BEVæ£€æµ‹ï¼‰

### 4. æŸå¤±å‡½æ•° âœ…
- **`models/loss.py`** - å„ç§æŸå¤±å‡½æ•°ï¼ˆFocal Lossã€æ—‹è½¬æŸå¤±ã€å¹³è¡¡MSEç­‰ï¼‰

### 5. ä¸»è®­ç»ƒæ¨¡å‹ âœ…
- **`world_track.py`** - è®­ç»ƒæµç¨‹æ ¸å¿ƒï¼ˆæ¨¡å‹åˆå§‹åŒ–ã€å‰å‘ä¼ æ’­ã€æŸå¤±è®¡ç®—ï¼‰

## ğŸ”„ å®Œæ•´è®­ç»ƒæµç¨‹å›¾

```mermaid
graph TD
    A[å¯åŠ¨è®­ç»ƒ] --> B[åŠ è½½é…ç½®æ–‡ä»¶]
    B --> C[åˆå§‹åŒ–æ•°æ®æ¨¡å—]
    C --> D[åˆ›å»ºæ•°æ®é›†]
    D --> E[æ•°æ®åŠ è½½ä¸é¢„å¤„ç†]
    E --> F[æ¨¡å‹å‰å‘ä¼ æ’­]
    F --> G[æŸå¤±è®¡ç®—]
    G --> H[åå‘ä¼ æ’­ä¸ä¼˜åŒ–]
    H --> I[è¯„ä¼°æŒ‡æ ‡è®¡ç®—]
    I --> J[ä¿å­˜æ£€æŸ¥ç‚¹]
    J --> K{è®­ç»ƒå®Œæˆ?}
    K -->|å¦| E
    K -->|æ˜¯| L[æµ‹è¯•è¯„ä¼°]
```

## ğŸ“Š æ•°æ®æµè¯¦è§£

### 1. æ•°æ®åŠ è½½é˜¶æ®µ
```python
# é…ç½®è§£æ
configs = [t_fit.yml, d_wildtrack.yml, m_liftnet.yml]

# æ•°æ®é›†åˆå§‹åŒ–
base_dataset = Wildtrack(data_dir)  # åŸºç¡€æ•°æ®é›†
pedestrian_dataset = PedestrianDataset(base_dataset)  # åŒ…è£…æ•°æ®é›†
datamodule = PedestrianDataModule(pedestrian_dataset)  # Lightningæ•°æ®æ¨¡å—
```

### 2. å•ä¸ªæ ·æœ¬å¤„ç†æµç¨‹
```python
# 1. åŠ è½½å¤šè§†è§’å›¾åƒ (7ç›¸æœº Ã— 3é€šé“ Ã— H Ã— W)
imgs = load_multiview_images()

# 2. åº”ç”¨æ•°æ®å¢å¼º (resize + crop + å½’ä¸€åŒ–)
imgs = apply_augmentation(imgs)

# 3. ç”ŸæˆGround Truth
center_bev = generate_bev_heatmap()      # BEVä¸­å¿ƒç‚¹çƒ­å›¾
offset_bev = generate_bev_offset()       # BEVåç§»é‡
center_img = generate_img_heatmap()      # å›¾åƒä¸­å¿ƒç‚¹çƒ­å›¾

# 4. åæ ‡ç³»è½¬æ¢
world_coords â†’ bev_coords â†’ memory_coords
```

### 3. æ¨¡å‹å‰å‘ä¼ æ’­
```python
# Liftnet å‰å‘ä¼ æ’­æµç¨‹
rgb_images â†’ 2D_features + depth_prediction
2D_features Ã— depth_weights â†’ 3D_voxel_features  # Liftingå…³é”®æ­¥éª¤
3D_voxel_features â†’ BEV_features                 # å‹ç¼©åˆ°BEV
BEV_features + temporal_cache â†’ final_BEV        # æ—¶åºèåˆ
final_BEV â†’ detection_outputs                    # è§£ç æ£€æµ‹ç»“æœ
```

### 4. æŸå¤±è®¡ç®—
```python
# å¤šä»»åŠ¡æŸå¤±ç»„åˆ
total_loss = (
    10 * focal_loss(center_pred, center_gt) +      # ä¸­å¿ƒç‚¹æ£€æµ‹
    10 * l1_loss(offset_pred, offset_gt) +         # åç§»å›å½’  
    smooth_l1_loss(tracking_pred, tracking_gt) +   # è·Ÿè¸ªç‰¹å¾
    l1_loss(size_pred, size_gt) +                  # å°ºå¯¸å›å½’
    rotation_loss(rot_pred, rot_gt) +              # æ—‹è½¬å›å½’
    image_loss(img_pred, img_gt)                   # å›¾åƒç©ºé—´æŸå¤±
) + uncertainty_losses                              # ä¸ç¡®å®šæ€§æƒé‡
```

## ğŸ¯ å…³é”®æŠ€æœ¯è¦ç‚¹

### 1. **å¤šè§†è§’ç‰¹å¾èåˆ**
- **æ–¹å¼1**: åŠ æƒå¹³å‡ï¼ˆåŸºäºè§‚æµ‹æ¬¡æ•°ï¼‰
- **æ–¹å¼2**: 3Då·ç§¯ç½‘ç»œèåˆ

### 2. **æ—¶åºä¿¡æ¯åˆ©ç”¨**
- ç¼“å­˜å‰ä¸€å¸§BEVç‰¹å¾
- è®¡ç®—æ—¶åºåç§»ç”¨äºè·Ÿè¸ª
- æ—¶åºèåˆç½‘ç»œ

### 3. **æ•°æ®å¢å¼ºç­–ç•¥**
- å›¾åƒï¼šéšæœºresize + crop
- åæ ‡ï¼šéšæœºå¹³ç§»æ‰°åŠ¨
- BEVï¼šéšæœºç¿»è½¬

### 4. **æŸå¤±å‡½æ•°è®¾è®¡**
- **Focal Loss**: è§£å†³æ­£è´Ÿæ ·æœ¬ä¸å¹³è¡¡
- **ä¸ç¡®å®šæ€§æƒé‡**: è‡ªåŠ¨å¹³è¡¡å¤šä»»åŠ¡æŸå¤±
- **å¤šå°ºåº¦ç›‘ç£**: BEV + å›¾åƒç©ºé—´

### 5. **è¯„ä¼°æŒ‡æ ‡**
- **MODA/MODP**: æ£€æµ‹ç²¾åº¦
- **MOTA/MOTP**: è·Ÿè¸ªç²¾åº¦
- **Recall/Precision**: åŸºç¡€æŒ‡æ ‡

## ğŸš€ å¯åŠ¨è®­ç»ƒå‘½ä»¤

```bash
python world_track.py fit \
    -c configs/t_fit.yml \
    -c configs/d_wildtrack.yml \
    -c configs/m_liftnet.yml
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
TrackTacular/WorldTrack/
â”œâ”€â”€ configs/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ t_fit.yml           # è®­ç»ƒé…ç½®
â”‚   â”œâ”€â”€ d_wildtrack.yml     # æ•°æ®é…ç½®  
â”‚   â””â”€â”€ m_liftnet.yml       # æ¨¡å‹é…ç½®
â”œâ”€â”€ datasets/               # æ•°æ®åŠ è½½
â”‚   â”œâ”€â”€ wildtrack_dataset.py
â”‚   â”œâ”€â”€ pedestrian_dataset.py
â”‚   â””â”€â”€ pedestrian_datamodule.py
â”œâ”€â”€ models/                 # æ¨¡å‹æ¶æ„
â”‚   â”œâ”€â”€ liftnet.py         # ä¸»è¦æ¨¡å‹
â”‚   â””â”€â”€ loss.py            # æŸå¤±å‡½æ•°
â”œâ”€â”€ evaluation/            # è¯„ä¼°å·¥å…·
â”‚   â”œâ”€â”€ mod.py            # MODA/MODPè®¡ç®—
â”‚   â””â”€â”€ mot_bev.py        # MOTA/MOTPè®¡ç®—
â””â”€â”€ world_track.py        # ä¸»è®­ç»ƒè„šæœ¬
```

## ğŸ‰ æ€»ç»“

é€šè¿‡è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼Œç°åœ¨å¯ä»¥æ¸…æ¥šåœ°ç†è§£ï¼š

1. **æ•°æ®æµ**: ä»åŸå§‹å›¾åƒåˆ°BEVæ£€æµ‹ç»“æœçš„å®Œæ•´è½¬æ¢è¿‡ç¨‹
2. **æ¨¡å‹æ¶æ„**: Liftnetå¦‚ä½•å°†2Dç‰¹å¾æå‡åˆ°3D BEVç©ºé—´
3. **è®­ç»ƒæµç¨‹**: æŸå¤±è®¡ç®—ã€ä¼˜åŒ–ã€è¯„ä¼°çš„å®Œæ•´å¾ªç¯
4. **å…³é”®æŠ€æœ¯**: å¤šè§†è§’èåˆã€æ—¶åºå»ºæ¨¡ã€å¤šä»»åŠ¡å­¦ä¹ 

æ‰€æœ‰ä»£ç éƒ½å·²æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œä¾¿äºç†è§£å’Œè¿›ä¸€æ­¥å¼€å‘ï¼âœ¨
